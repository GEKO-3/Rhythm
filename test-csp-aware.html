<!DOCTYPE html>
<html>
<head>
    <title>Test Form Submission with CSP Handling</title>
</head>
<body>
    <h1>Test Form Submission - CSP Aware</h1>
    <p>This test handles the expected CSP (Content Security Policy) error from Google Forms.</p>
    
    <div class="info-box">
        <h3>üìã About the CSP Error:</h3>
        <p>The error <code>"Refused to frame 'https://docs.google.com/' because an ancestor violates the following Content Security Policy directive: 'frame-ancestors 'none'"</code> is <strong>expected and normal</strong>.</p>
        <p>This happens because Google prevents their forms from being loaded in iframes for security reasons. However, the form submission itself still works!</p>
    </div>
    
    <button onclick="testFetchSubmission()">Test Fetch Submission (Primary)</button>
    <button onclick="testIframeSubmission()">Test Iframe Submission (Fallback)</button>
    <div id="result"></div>
    
    <script>
        function testFetchSubmission() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>üîÑ Testing fetch submission (primary method)...</p>';
            
            const formData = new FormData();
            const testData = {
                'entry.1045084900': 'fetch.test@example.com',
                'entry.1638269417': 'Fetch Test User',
                'entry.286303387': '07/20/1995', // Date of Birth (mm/dd/yyyy format for Google Forms)
                'entry.2119829349': '+960 9876543', // Contact Number (corrected)
                'entry.520958378': 'Yes',
                'entry.520958378_sentinel': ''
            };
            
            Object.entries(testData).forEach(([name, value]) => {
                formData.append(name, value);
            });
            
            fetch('https://docs.google.com/forms/d/e/1FAIpQLSdNpLTCh88RfKrFFGF3zbogSYdKLDvtk2ZzjFljxJFKUVvqJw/formResponse', {
                method: 'POST',
                mode: 'no-cors',
                body: formData
            }).then(() => {
                resultDiv.innerHTML = `
                    <div style="color: green;">
                        <h3>‚úÖ Fetch Submission Completed</h3>
                        <p>The fetch request was sent successfully using no-cors mode.</p>
                        <p><strong>Check your Google Form responses</strong> to verify the data was received:</p>
                        <ul>
                            <li>Email: fetch.test@example.com</li>
                            <li>Name: Fetch Test User</li>
                            <li>Birthday: 20/07/1995</li>
                            <li>Contact: +960 9876543</li>
                            <li>Location: Yes</li>
                        </ul>
                    </div>
                `;
            }).catch(error => {
                resultDiv.innerHTML = `
                    <div style="color: orange;">
                        <h3>‚ö†Ô∏è Fetch Error (Expected)</h3>
                        <p>Error: ${error.message}</p>
                        <p>This might be normal due to CORS restrictions, but the submission may still have worked.</p>
                    </div>
                `;
            });
        }
        
        function testIframeSubmission() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>üîÑ Testing iframe submission (fallback method)...</p>';
            
            // Create form
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = 'https://docs.google.com/forms/d/e/1FAIpQLSdNpLTCh88RfKrFFGF3zbogSYdKLDvtk2ZzjFljxJFKUVvqJw/formResponse';
            form.target = 'test_iframe';
            form.style.display = 'none';
            
            const testData = {
                'entry.1045084900': 'iframe.test@example.com',
                'entry.1638269417': 'Iframe Test User',
                'entry.286303387': '12/25/1988', // Date of Birth (mm/dd/yyyy format for Google Forms)
                'entry.2119829349': '+960 1122334', // Contact Number (corrected)
                'entry.520958378': 'No',
                'entry.520958378_sentinel': ''
            };
            
            Object.entries(testData).forEach(([name, value]) => {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = name;
                input.value = value;
                form.appendChild(input);
            });
            
            // Create iframe
            const iframe = document.createElement('iframe');
            iframe.name = 'test_iframe';
            iframe.style.display = 'none';
            document.body.appendChild(iframe);
            document.body.appendChild(form);
            
            let submitted = false;
            
            const handleResult = (eventType) => {
                if (!submitted) {
                    submitted = true;
                    resultDiv.innerHTML = `
                        <div style="color: green;">
                            <h3>‚úÖ Iframe Submission Attempted</h3>
                            <p>Event: ${eventType}</p>
                            <p>The CSP error in console is <strong>expected and normal</strong>.</p>
                            <p>The form data was likely submitted successfully despite the iframe being blocked.</p>
                            <p><strong>Check your Google Form responses</strong> to verify:</p>
                            <ul>
                                <li>Email: iframe.test@example.com</li>
                                <li>Name: Iframe Test User</li>
                                <li>Birthday: 25/12/1988</li>
                                <li>Contact: +960 1122334</li>
                                <li>Location: No</li>
                            </ul>
                        </div>
                    `;
                    
                    // Cleanup
                    setTimeout(() => {
                        if (document.body.contains(form)) document.body.removeChild(form);
                        if (document.body.contains(iframe)) document.body.removeChild(iframe);
                    }, 1000);
                }
            };
            
            // Handle both load and error events (CSP will trigger error)
            iframe.addEventListener('load', () => handleResult('load'));
            iframe.addEventListener('error', () => handleResult('error (CSP block)'));
            
            // Submit and assume success after timeout
            form.submit();
            setTimeout(() => {
                if (!submitted) {
                    handleResult('timeout (likely successful)');
                }
            }, 3000);
        }
    </script>
    
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            line-height: 1.6; 
        }
        button { 
            background: #2196F3; 
            color: white; 
            padding: 12px 24px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            font-size: 14px;
            margin: 5px;
        }
        button:hover { 
            background: #1976D2; 
        }
        #result { 
            margin-top: 20px; 
            padding: 15px; 
            background: #f9f9f9; 
            border-radius: 5px; 
            border-left: 4px solid #2196F3;
        }
        .info-box {
            background: #e3f2fd;
            border: 1px solid #2196F3;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
        }
        .info-box h3 {
            margin-top: 0;
            color: #1976D2;
        }
        code {
            background: #f5f5f5;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 0.9em;
        }
        ul {
            margin: 10px 0;
        }
        li {
            margin: 5px 0;
        }
    </style>
</body>
</html>
