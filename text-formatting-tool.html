<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Text Formatting Tool</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thaana:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: Arial, sans-serif; margin: 30px; background: #f7f7fa; }
        .section { background: #fff; border: 1px solid #d1d5db; padding: 18px 20px 15px 20px; margin-bottom: 28px; border-radius: 10px; box-shadow: 0 2px 8px #0001; position: relative; }
        .section-title { font-weight: bold; margin-bottom: 10px; font-size: 1.1em; padding: 6px 10px; border-radius: 5px; border: 1px solid #e5e7eb; background: #f3f4f6; width: 60%; }
        .line { display: flex; align-items: center; margin-bottom: 10px; gap: 8px; }
        .line input[type="text"] {
            flex: 1;
            margin-right: 0;
            padding: 6px 10px;
            border-radius: 5px;
            border: 1px solid #e5e7eb;
            background: #f9fafb;
            font-family: 'Noto Sans Thaana', Arial, sans-serif;
            direction: rtl;
            font-size: 1.1em;
        }
        .line input[type="checkbox"] { width: 18px; height: 18px; accent-color: #6366f1; }
        .controls, .section > button, .line > button { margin-top: 10px; }
        button { background: #6366f1; color: #fff; border: none; border-radius: 5px; padding: 7px 15px; font-size: 1em; cursor: pointer; transition: background 0.2s; }
        button:hover { background: #4338ca; }
        .section > button { position: absolute; top: 15px; right: 18px; background: #ef4444; }
        .section > button:hover { background: #b91c1c; }
        .line > button {
            background: #f59e42;
            color: #fff;
            padding: 5px 10px;
            font-size: 0.95em;
        }
        .line > button:hover {
            background: #d97706;
        }
        .remove-line-btn {
            width: 26px;
            height: 26px;
            background: #f59e42;
            color: #fff;
            border: none;
            border-radius: 5px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            margin-left: 6px;
            transition: background 0.2s;
        }
        .remove-line-btn:hover {
            background: #d97706;
        }
        .controls { margin-top: 20px; display: flex; gap: 12px; }
        h2 { color: #3730a3; margin-bottom: 25px; }
        .remove-section-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 28px;
            height: 28px;
            background: #ef4444;
            color: #fff;
            border: none;
            border-radius: 6px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            transition: background 0.2s;
            z-index: 2;
        }
        .remove-section-btn:hover {
            background: #b91c1c;
        }
        .section > button:not(.remove-section-btn) {
            margin-top: 10px;
        }
        @media (max-width: 600px) {
            .section { padding: 10px; }
            .section-title { width: 100%; }
        }
    </style>
</head>
<body>
    <h2>Text Formatting Tool</h2>
    <div id="sections"></div>
    <div class="controls">
        <button onclick="addSection()">Add Section</button>
        <button onclick="addLineToLastSection()">Add Line</button>
        <button onclick="copyToClipboard()">Copy to Clipboard</button>
    </div>

    <script>
        let sectionCount = 0;
        function transliterateToThaana(text) {
            // Custom mapping provided by user
            const map = {
                'A': 'ާ', 'B': 'ޞ', 'C': 'ޝ', 'D': 'ޑ', 'E': 'ޭ', 'F': 'ﷲ', 'G': 'ޣ', 'H': 'ޙ', 'I': 'ީ', 'J': 'ޛ', 'K': 'ޚ', 'L': 'ޅ', 'M': 'ޟ', 'N': 'ޏ', 'O': 'ޯ', 'P': '÷', 'Q': 'ޤ', 'R': 'ޜ', 'S': 'ށ', 'T': 'ޓ', 'U': 'ޫ', 'V': 'ޥ', 'W': 'ޢ', 'X': 'ޘ', 'Y': 'ޠ', 'Z': 'ޡ',
                'a': 'ަ', 'b': 'ބ', 'c': 'ޗ', 'd': 'ދ', 'e': 'ެ', 'f': 'ފ', 'g': 'ގ', 'h': 'ހ', 'i': 'ި', 'j': 'ޖ', 'k': 'ކ', 'l': 'ލ', 'm': 'މ', 'n': 'ނ', 'o': 'ޮ', 'p': 'ޕ', 'q': 'ް', 'r': 'ރ', 's': 'ސ', 't': 'ތ', 'u': 'ު', 'v': 'ވ', 'w': 'އ', 'x': '×', 'y': 'ޔ', 'z': 'ޒ'
            };
            return text.split('').map(ch => map[ch] || ch).join('');
        }

        function setupThaanaTransliteration(input) {
            input.addEventListener('input', function(e) {
                const caret = input.selectionStart;
                const original = input.value;
                const thaana = transliterateToThaana(original);
                if (original !== thaana) {
                    input.value = thaana;
                    input.setSelectionRange(caret, caret);
                }
            });
        }

        function addSection() {
            sectionCount++;
            const sectionsDiv = document.getElementById('sections');
            const section = document.createElement('div');
            section.className = 'section';
            section.dataset.sectionId = sectionCount;
            section.innerHTML = `
                <input type="text" class="section-title" placeholder="Section Name" />
                <button class="remove-section-btn" title="Remove Section" onclick="removeSection(this.parentNode)">×</button>
                <div class="lines"></div>
                <div style="margin-top: 32px;"><button onclick="addLine(this.parentNode.parentNode)">Add Line</button></div>
            `;
            sectionsDiv.appendChild(section);
            const sectionTitleInput = section.querySelector('.section-title');
            setupThaanaTransliteration(sectionTitleInput);
            addLine(section); // Add first line by default
        }

        function addLine(sectionDiv) {
            const linesDiv = sectionDiv.querySelector('.lines');
            const lineDiv = document.createElement('div');
            lineDiv.className = 'line';
            lineDiv.innerHTML = `
                <input type="text" placeholder="Enter text..." />
                <input type="checkbox" title="Star this line" />
                <button class="remove-line-btn" title="Remove Line" onclick="removeLine(this.parentNode)">×</button>
            `;
            linesDiv.appendChild(lineDiv);
            const lineInput = lineDiv.querySelector('input[type="text"]');
            setupThaanaTransliteration(lineInput);
        }

        function addLineToLastSection() {
            const sections = document.querySelectorAll('.section');
            if (sections.length === 0) {
                addSection();
            } else {
                addLine(sections[sections.length - 1]);
            }
        }

        function copyToClipboard() {
            let output = '';
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => {
                const sectionTitle = section.querySelector('.section-title').value.trim();
                if (sectionTitle) {
                    output += `[${sectionTitle}]:\n`;
                }
                const lines = section.querySelectorAll('.line');
                lines.forEach(line => {
                    const input = line.querySelector('input[type="text"]');
                    const checkbox = line.querySelector('input[type="checkbox"]');
                    let text = input.value.trim();
                    if (text) {
                        if (checkbox.checked) text = '*' + text;
                        output += text + '\n';
                    }
                });
                output += '\n';
            });
            navigator.clipboard.writeText(output.trim()).then(() => {
                alert('Copied to clipboard!');
            });
        }

        function removeLine(lineDiv) {
            lineDiv.remove();
        }

        function removeSection(sectionDiv) {
            sectionDiv.remove();
        }

        // Initialize with one section
        addSection();
    </script>
</body>
</html>
